{"remainingRequest":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\thread-loader\\dist\\cjs.js!E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\babel-loader\\lib\\index.js!E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\code\\energy\\qiantai\\vue-energy-copy\\src\\components\\user\\role.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\src\\components\\user\\role.vue","mtime":1563503996015},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      list: [],\n      //表格的数据\n      allPermission: [],\n      listLoading: false,\n      //数据加载等待动画\n      dialogStatus: \"create\",\n      dialogFormVisible: false,\n      textMap: {\n        update: \"编辑\",\n        create: \"新建角色\"\n      },\n      tempRole: {\n        roleName: \"\",\n        roleId: \"\",\n        permissions: []\n      },\n      adminName: \"管理员\"\n    };\n  },\n  created: function created() {\n    this.getList();\n    this.getAllPermisson();\n  },\n  methods: {\n    getAllPermisson: function getAllPermisson() {\n      var _this = this;\n\n      //查询所有权限\n      this.api({\n        url: \"/api/user/listAllPermission\",\n        method: \"get\"\n      }).then(function (data) {\n        _this.allPermission = data.list;\n      });\n    },\n    getList: function getList() {\n      var _this2 = this;\n\n      //查询列表\n      this.listLoading = true;\n      this.api({\n        url: \"/api/user/listRole\",\n        method: \"get\"\n      }).then(function (data) {\n        _this2.listLoading = false;\n        _this2.list = data.list;\n      });\n    },\n    getIndex: function getIndex($index) {\n      //表格序号\n      return $index + 1;\n    },\n    showCreate: function showCreate() {\n      //显示新增对话框\n      this.tempRole.roleName = \"\";\n      this.tempRole.roleId = \"\";\n      this.tempRole.permissions = [];\n      this.dialogStatus = \"create\";\n      this.dialogFormVisible = true;\n    },\n    showUpdate: function showUpdate($index) {\n      console.log($index);\n      console.log(this.list);\n      var role = this.list[$index];\n      console.log(role);\n      this.tempRole.roleName = role.roleName;\n      this.tempRole.roleId = role.roleId;\n      this.tempRole.permissions = [];\n\n      for (var i = 0; i < role.menus.length; i++) {\n        var perm = role.menus[i].permissions;\n\n        for (var j = 0; j < perm.length; j++) {\n          this.tempRole.permissions.push(perm[j].permissionId);\n        }\n      }\n\n      console.log(this.tempRole);\n      this.dialogStatus = \"update\";\n      this.dialogFormVisible = true;\n    },\n    createRole: function createRole() {\n      var _this3 = this;\n\n      if (!this.checkRoleNameUnique()) {\n        return;\n      }\n\n      if (!this.checkPermissionNum()) {\n        return;\n      } //添加新角色\n\n\n      this.api({\n        url: \"/api/user/addRole\",\n        method: \"post\",\n        data: this.tempRole\n      }).then(function () {\n        _this3.getList();\n\n        _this3.dialogFormVisible = false;\n      });\n    },\n    updateRole: function updateRole() {\n      var _this4 = this;\n\n      if (!this.checkRoleNameUnique(this.tempRole.roleId)) {\n        return;\n      }\n\n      if (!this.checkPermissionNum()) {\n        return;\n      } //修改角色\n\n\n      this.api({\n        url: \"/api/user/updateRole\",\n        method: \"post\",\n        data: this.tempRole\n      }).then(function () {\n        _this4.getList();\n\n        _this4.dialogFormVisible = false;\n      });\n    },\n    checkPermissionNum: function checkPermissionNum() {\n      //校验至少有一种权限\n      if (this.tempRole.permissions.length === 0) {\n        this.$message.error(\"请至少选择一种权限\");\n        return false;\n      }\n\n      return true;\n    },\n    checkRoleNameUnique: function checkRoleNameUnique(roleId) {\n      //校验名称重复\n      var roleName = this.tempRole.roleName;\n\n      if (!roleName) {\n        this.$message.error(\"请填写角色名称\");\n        return false;\n      }\n\n      var roles = this.list;\n      var result = true;\n\n      for (var j = 0; j < roles.length; j++) {\n        if (roles[j].roleName === roleName && (!roleId || roles[j].roleId !== roleId)) {\n          this.$message.error(\"角色名称已存在\");\n          result = false;\n          break;\n        }\n      }\n\n      return result;\n    },\n    removeRole: function removeRole($index) {\n      var _vue = this;\n\n      this.$confirm(\"确定删除此角色?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        showCancelButton: false,\n        type: \"warning\"\n      }).then(function () {\n        var role = _vue.list[$index];\n\n        _vue.api({\n          url: \"/api/user/deleteRole\",\n          method: \"post\",\n          data: {\n            roleId: role.roleId\n          }\n        }).then(function () {\n          _vue.getList();\n        }).catch(function (e) {});\n      });\n    },\n    isMenuNone: function isMenuNone(_index) {\n      //判断本级菜单内的权限是否一个都没选\n      var menu = this.allPermission[_index].permissions;\n      var result = true;\n\n      for (var j = 0; j < menu.length; j++) {\n        if (this.tempRole.permissions.indexOf(menu[j].id) > -1) {\n          result = false;\n          break;\n        }\n      }\n\n      return result;\n    },\n    isMenuAll: function isMenuAll(_index) {\n      //判断本级菜单内的权限是否全选了\n      var menu = this.allPermission[_index].permissions;\n      var result = true;\n\n      for (var j = 0; j < menu.length; j++) {\n        if (this.tempRole.permissions.indexOf(menu[j].id) < 0) {\n          result = false;\n          break;\n        }\n      }\n\n      return result;\n    },\n    checkAll: function checkAll(_index) {\n      //点击菜单   相当于全选按钮\n      var v = this;\n\n      if (v.isMenuAll(_index)) {\n        //如果已经全选了,则全部取消\n        v.noPerm(_index);\n      } else {\n        //如果尚未全选,则全选\n        v.allPerm(_index);\n      }\n    },\n    allPerm: function allPerm(_index) {\n      //全部选中\n      var menu = this.allPermission[_index].permissions;\n\n      for (var j = 0; j < menu.length; j++) {\n        this.addUnique(menu[j].id, this.tempRole.permissions);\n      }\n    },\n    noPerm: function noPerm(_index) {\n      //全部取消选中\n      var menu = this.allPermission[_index].permissions;\n\n      for (var j = 0; j < menu.length; j++) {\n        var idIndex = this.tempRole.permissions.indexOf(menu[j].id);\n\n        if (idIndex > -1) {\n          this.tempRole.permissions.splice(idIndex, 1);\n        }\n      }\n    },\n    addUnique: function addUnique(val, arr) {\n      //数组内防重复地添加元素\n      var _index = arr.indexOf(val);\n\n      if (_index < 0) {\n        arr.push(val);\n      }\n    },\n    checkRequired: function checkRequired(_perm, _index) {\n      //本方法会在勾选状态改变之后触发\n      var permId = _perm.id;\n\n      if (this.tempRole.permissions.indexOf(permId) > -1) {\n        //选中事件\n        //如果之前未勾选本权限,现在勾选完之后,tempRole里就会包含本id\n        //那么就要将必选的权限勾上\n        this.makeReuqiredPermissionChecked(_index);\n      } else {\n        //取消选中事件\n        if (_perm.requiredPerm === 1) {\n          //如果是必勾权限,就把本菜单的权限全部移出\n          //(其实也可以提示用户本权限是菜单里的必选,请先取消勾选另外几个权限,交互太麻烦,此处就直接全部取消选中了)\n          this.noPerm(_index);\n        }\n      }\n    },\n    makeReuqiredPermissionChecked: function makeReuqiredPermissionChecked(_index) {\n      //将本菜单必选的权限勾上\n      var menu = this.allPermission[_index].permissions;\n\n      for (var j = 0; j < menu.length; j++) {\n        var perm = menu[j];\n\n        if (perm.requiredPerm === 1) {\n          //找到本菜单的必选权限,将其勾上\n          this.addUnique(perm.id, this.tempRole.permissions);\n        }\n      }\n    }\n  }\n};",null]}