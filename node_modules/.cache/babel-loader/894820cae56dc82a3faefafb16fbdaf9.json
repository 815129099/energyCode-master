{"remainingRequest":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\thread-loader\\dist\\cjs.js!E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\babel-loader\\lib\\index.js!E:\\code\\energy\\qiantai\\vue-energy-copy\\src\\store\\modules\\user.js","dependencies":[{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\src\\store\\modules\\user.js","mtime":1563933131193},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\energy\\qiantai\\vue-energy-copy\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"E:\\\\code\\\\energy\\\\qiantai\\\\vue-energy-copy\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\n//import {getInfo, login, logout} from '@/api/login'\nimport store from '../../store';\nimport router from '../../router'; //import API from '@/api';\n\nimport { default as api } from '../../api/utils/api';\nvar user = {\n  state: {\n    nickname: \"\",\n    userId: \"\",\n    avatar: 'https://www.gravatar.com/avatar/6560ed55e62396e40b34aac1e5041028',\n    role: '',\n    menus: [],\n    permissions: []\n  },\n  mutations: {\n    SET_USER: function SET_USER(state, userInfo) {\n      state.nickname = userInfo.nickname;\n      state.userId = userInfo.userId;\n      state.role = userInfo.roleName;\n      state.menus = userInfo.menuList;\n      state.permissions = userInfo.permissionList;\n    },\n    RESET_USER: function RESET_USER(state) {\n      state.nickname = \"\";\n      state.userId = \"\";\n      state.role = '';\n      state.menus = [];\n      state.permissions = [];\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref, loginForm) {\n      var commit = _ref.commit,\n          state = _ref.state;\n      return new _Promise(function (resolve, reject) {\n        api({\n          url: \"/api/login/auth\",\n          method: \"post\",\n          data: loginForm\n        }).then(function (data) {\n          if (data.result === \"success\") {\n            //cookie中保存前端登录状态\n            localStorage.setItem(\"username\", loginForm.username);\n          }\n\n          resolve(data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref2) {\n      var commit = _ref2.commit,\n          state = _ref2.state;\n      //resolve是对promise成功时候的回调，它把promise的状态修改为fullfiled，reject就是失败的时候的回调，\n      //他把promise的状态修改为rejected，这样我们在then中就能捕捉到，然后执行“失败”情况的回调。\n      return new _Promise(function (resolve, reject) {\n        api({\n          url: '/api/login/getInfo',\n          method: 'post'\n        }).then(function (data) {\n          //储存用户信息\n          commit('SET_USER', data.userPermission); //cookie保存登录状态,仅靠vuex保存的话,页面刷新就会丢失登录状态\n\n          localStorage.setItem(\"username\", data.userPermission.username);\n          localStorage.setItem(\"nickname\", data.userPermission.nickname);\n          localStorage.setItem(\"rolename\", data.userPermission.roleName); //生成路由\n\n          var userPermission = data.userPermission;\n          store.dispatch('GenerateRoutes', userPermission).then(function () {\n            //生成该用户的新路由json操作完毕之后,调用vue-router的动态新增路由方法,将新路由添加\n            router.addRoutes(store.getters.addRouters);\n          });\n          resolve(data);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref3) {\n      var commit = _ref3.commit;\n      return new _Promise(function (resolve) {\n        api({\n          url: \"/api/login/logout\",\n          method: \"post\"\n        }).then(function (data) {\n          commit('RESET_USER');\n          localStorage.removeItem(\"username\");\n          localStorage.removeItem(\"rolename\");\n          localStorage.removeItem(\"nickname\");\n          resolve(data);\n        }).catch(function () {\n          commit('RESET_USER');\n          localStorage.removeItem(\"username\");\n          localStorage.removeItem(\"rolename\");\n          localStorage.removeItem(\"nickname\");\n        });\n      });\n    },\n    // 前端 登出\n    FedLogOut: function FedLogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new _Promise(function (resolve) {\n        commit('RESET_USER');\n        localStorage.removeItem(\"username\");\n        localStorage.removeItem(\"rolename\");\n        localStorage.removeItem(\"nickname\");\n        resolve();\n      });\n    }\n  }\n};\nexport default user;",null]}