{"remainingRequest":"E:\\code\\vue-workspace\\vue-manage-system-master\\node_modules\\babel-loader\\lib\\index.js!E:\\code\\vue-workspace\\vue-manage-system-master\\src\\api\\utils\\index.js","dependencies":[{"path":"E:\\code\\vue-workspace\\vue-manage-system-master\\src\\api\\utils\\index.js","mtime":1554970625731},{"path":"E:\\code\\vue-workspace\\vue-manage-system-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\code\\vue-workspace\\vue-manage-system-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"E:\\\\code\\\\vue-workspace\\\\vue-manage-system-master\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\n// store/permission.js\nimport { asyncRouterMap, constantRouterMap } from 'src/router';\n\nfunction hasPermission(roles, route) {\n  if (route.meta && route.meta.role) {\n    return roles.some(function (role) {\n      return route.meta.role.indexOf(role) >= 0;\n    });\n  } else {\n    return true;\n  }\n}\n\nvar permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: function SET_ROUTERS(state, routers) {\n      state.addRouters = routers;\n      state.routers = constantRouterMap.concat(routers);\n    }\n  },\n  actions: {\n    GenerateRoutes: function GenerateRoutes(_ref, data) {\n      var commit = _ref.commit;\n      return new _Promise(function (resolve) {\n        var roles = data.roles;\n        var accessedRouters = asyncRouterMap.filter(function (v) {\n          if (roles.indexOf('admin') >= 0) return true;\n\n          if (hasPermission(roles, v)) {\n            if (v.children && v.children.length > 0) {\n              v.children = v.children.filter(function (child) {\n                if (hasPermission(roles, child)) {\n                  return child;\n                }\n\n                return false;\n              });\n              return v;\n            } else {\n              return v;\n            }\n          }\n\n          return false;\n        });\n        commit('SET_ROUTERS', accessedRouters);\n        resolve();\n      });\n    }\n  }\n};\nexport default permission;",{"version":3,"sources":["E:\\code\\vue-workspace\\vue-manage-system-master\\src\\api\\utils\\index.js"],"names":["asyncRouterMap","constantRouterMap","hasPermission","roles","route","meta","role","some","indexOf","permission","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","data","commit","resolve","accessedRouters","filter","v","children","length","child"],"mappings":";AAAA;AACA,SAASA,cAAT,EAAyBC,iBAAzB,QAAkD,YAAlD;;AAEA,SAASC,aAAT,CAAuBC,KAAvB,EAA8BC,KAA9B,EAAqC;AACnC,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWC,IAA7B,EAAmC;AACjC,WAAOH,KAAK,CAACI,IAAN,CAAW,UAAAD,IAAI;AAAA,aAAIF,KAAK,CAACC,IAAN,CAAWC,IAAX,CAAgBE,OAAhB,CAAwBF,IAAxB,KAAiC,CAArC;AAAA,KAAf,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF;;AAED,IAAMG,UAAU,GAAG;AACjBC,EAAAA,KAAK,EAAE;AACLC,IAAAA,OAAO,EAAEV,iBADJ;AAELW,IAAAA,UAAU,EAAE;AAFP,GADU;AAKjBC,EAAAA,SAAS,EAAE;AACTC,IAAAA,WAAW,EAAE,qBAACJ,KAAD,EAAQC,OAAR,EAAoB;AAC/BD,MAAAA,KAAK,CAACE,UAAN,GAAmBD,OAAnB;AACAD,MAAAA,KAAK,CAACC,OAAN,GAAgBV,iBAAiB,CAACc,MAAlB,CAAyBJ,OAAzB,CAAhB;AACD;AAJQ,GALM;AAWjBK,EAAAA,OAAO,EAAE;AACPC,IAAAA,cADO,gCACoBC,IADpB,EAC0B;AAAA,UAAhBC,MAAgB,QAAhBA,MAAgB;AAC/B,aAAO,aAAY,UAAAC,OAAO,EAAI;AAAA,YACpBjB,KADoB,GACVe,IADU,CACpBf,KADoB;AAE5B,YAAMkB,eAAe,GAAGrB,cAAc,CAACsB,MAAf,CAAsB,UAAAC,CAAC,EAAI;AACjD,cAAIpB,KAAK,CAACK,OAAN,CAAc,OAAd,KAA0B,CAA9B,EAAiC,OAAO,IAAP;;AACjC,cAAIN,aAAa,CAACC,KAAD,EAAQoB,CAAR,CAAjB,EAA6B;AAC3B,gBAAIA,CAAC,CAACC,QAAF,IAAcD,CAAC,CAACC,QAAF,CAAWC,MAAX,GAAoB,CAAtC,EAAyC;AACvCF,cAAAA,CAAC,CAACC,QAAF,GAAaD,CAAC,CAACC,QAAF,CAAWF,MAAX,CAAkB,UAAAI,KAAK,EAAI;AACtC,oBAAIxB,aAAa,CAACC,KAAD,EAAQuB,KAAR,CAAjB,EAAiC;AAC/B,yBAAOA,KAAP;AACD;;AACD,uBAAO,KAAP;AACD,eALY,CAAb;AAMA,qBAAOH,CAAP;AACD,aARD,MAQO;AACL,qBAAOA,CAAP;AACD;AACF;;AACD,iBAAO,KAAP;AACD,SAhBuB,CAAxB;AAiBAJ,QAAAA,MAAM,CAAC,aAAD,EAAgBE,eAAhB,CAAN;AACAD,QAAAA,OAAO;AACR,OArBM,CAAP;AAsBD;AAxBM;AAXQ,CAAnB;AAuCA,eAAeX,UAAf","sourcesContent":["// store/permission.js\r\nimport { asyncRouterMap, constantRouterMap } from 'src/router';\r\n\r\nfunction hasPermission(roles, route) {\r\n  if (route.meta && route.meta.role) {\r\n    return roles.some(role => route.meta.role.indexOf(role) >= 0)\r\n  } else {\r\n    return true\r\n  }\r\n}\r\n\r\nconst permission = {\r\n  state: {\r\n    routers: constantRouterMap,\r\n    addRouters: []\r\n  },\r\n  mutations: {\r\n    SET_ROUTERS: (state, routers) => {\r\n      state.addRouters = routers;\r\n      state.routers = constantRouterMap.concat(routers);\r\n    }\r\n  },\r\n  actions: {\r\n    GenerateRoutes({ commit }, data) {\r\n      return new Promise(resolve => {\r\n        const { roles } = data;\r\n        const accessedRouters = asyncRouterMap.filter(v => {\r\n          if (roles.indexOf('admin') >= 0) return true;\r\n          if (hasPermission(roles, v)) {\r\n            if (v.children && v.children.length > 0) {\r\n              v.children = v.children.filter(child => {\r\n                if (hasPermission(roles, child)) {\r\n                  return child\r\n                }\r\n                return false;\r\n              });\r\n              return v\r\n            } else {\r\n              return v\r\n            }\r\n          }\r\n          return false;\r\n        });\r\n        commit('SET_ROUTERS', accessedRouters);\r\n        resolve();\r\n      })\r\n    }\r\n  }\r\n};\r\n\r\nexport default permission;\r\n\r\n"]}]}